pipelines:
  branches:
    master:
      - step:
          name: Generate docs
          image: jwahab/go-protoc:latest
          script:
            - make gen
          artifacts:
            - docs/**
      - parallel:
        - step:
            name: Deploy to ehr_ps1
            deployment: ehr_ps1
            image: kroniak/ssh-client:latest
            clone:
              enabled: false
            script:
              - pipe: atlassian/scp-deploy:0.3.3
                variables:
                  USER: $USER
                  SERVER: $SERVER
                  REMOTE_PATH: '/home/$USER/docs'
                  LOCAL_PATH: 'docs/internal/*'
        - step:
            name: Deploy to ehr_cust1
            deployment: ehr_cust1
            image: kroniak/ssh-client:latest
            clone:
              enabled: false
            script:
              - pipe: atlassian/scp-deploy:0.3.3
                variables:
                  USER: $USER
                  SERVER: $SERVER
                  REMOTE_PATH: '/home/$USER/docs'
                  LOCAL_PATH: 'docs/external/*'
      - step:
          name: Deploy to bowstave-docs
          deployment: bowstave-docs
          image: kroniak/ssh-client:latest
          clone:
            enabled: false
          script:
            - pipe: atlassian/scp-deploy:0.3.3
              variables:
                USER: $USER
                SERVER: $SERVER
                REMOTE_PATH: '/home/$USER/docs'
                LOCAL_PATH: 'docs/internal/*'